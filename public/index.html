<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlogCareers</title>
</head>
<body>
    <h1>Create Blog</h1>
    <form id="form-group">
        <input type="hidden" id="userId">
        <div id="form-group1">
            <label for="postLink">PostLink:</label>
            <br>
            <input id="postLink" type="text" required>
            <br>
            <label for="postDescription">Post Description:</label>
            <br>
            <input id="postDescription" type="text" name="postDescription" required>
            <br><br>
    
            <button type="button" id="button1">createPost</button> <!-- Changed type to "button" -->
        </div>
    </form>
    <br><br>
    <div id="posts"></div>

    <script>
        document.getElementById('button1').addEventListener('click', addBlog);
        function addBlog(){
            const postLink = document.getElementById('postLink').value;
            const postDescription = document.getElementById('postDescription').value;
            const userId = document.getElementById('userId').value;

            const method = userId ? 'PUT' : 'POST'; // Corrected typo and simplified condition
            const url = userId ? `api/users/${userId}` : `api/posts`; // Changed url to posts

            fetch(url, {
                method,
                headers: { 'content-type': 'application/json' },
                body: JSON.stringify({ postLink, postDescription })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Blog data added ', data);
                fetchBlog();
            })
            .catch(error => { // Corrected typo
                console.error('Error on adding', error);
            });
        }

        function fetchBlog() {
            fetch('/api/posts')
            .then(response => response.json())
            .then(posts => {
                const postsDiv = document.getElementById('posts');
                postsDiv.innerHTML = '';

                posts.forEach(post => {
                    const postDiv = document.createElement('div');
                    postDiv.innerHTML = `
                        <p>${post.postLink}, Description: ${post.postDescription}</p> <!-- Corrected variable name -->
                        <br>
                        <div>
                            <input type="text" placeholder="write your comment" id="comment1"> <!-- Corrected placeholder -->
                            <button onclick="addComment()">Send</button> <!-- Corrected function name -->
                        </div>`;
                    postsDiv.appendChild(postDiv); // Corrected variable name
                });
            })
            .catch(error => {
                console.error('Error fetching Posts:', error); // Corrected console message
            });
        }

        function addComment(){ // Corrected function name
            const comment = document.getElementById('comment1').value;
            const commentDiv = document.createElement('div');
            commentDiv.textContent = comment; // Added textContent to create a text node
            document.getElementById('posts').appendChild(commentDiv); // Appended to the posts div
        }
        
        // Initial call to fetch posts
        fetchBlog();
    </script>
</body>
</html>
